{"ast":null,"code":"import React,{useState,useRef,useEffect}from'react';import{Container,Message,Segment,Header,Button}from'semantic-ui-react';import jsQR from'jsqr';import{useAuth}from'../context/AuthContext';import{backApi}from'../misc/BackApi';import{handleLogError}from'../misc/Helpers';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ScanQR=()=>{const{getUser}=useAuth();const navigate=useNavigate();const[error,setError]=useState(null);const[transactionDetails,setTransactionDetails]=useState(null);const[scanning,setScanning]=useState(false);const videoRef=useRef(null);const handleScanQR=()=>{setScanning(true);setError(null);setTransactionDetails(null);};useEffect(()=>{handleScanQR();},[]);useEffect(()=>{if(scanning){const canvas=document.createElement('canvas');const context=canvas.getContext('2d');const video=videoRef.current;navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}}).then(stream=>{video.srcObject=stream;video.setAttribute('playsinline',true);video.play();const scan=()=>{if(video.readyState===video.HAVE_ENOUGH_DATA){canvas.height=video.videoHeight;canvas.width=video.videoWidth;context.drawImage(video,0,0,canvas.width,canvas.height);const imageData=context.getImageData(0,0,canvas.width,canvas.height);const code=jsQR(imageData.data,imageData.width,imageData.height);if(code){try{const transactionData=JSON.parse(code.data);setTransactionDetails(transactionData);stream.getTracks().forEach(track=>track.stop());setScanning(false);navigate('/confirm-transaction',{state:{transactionDetails:transactionData}});}catch(e){setError('Failed to parse QR code data');}}}if(scanning){requestAnimationFrame(scan);}};scan();}).catch(err=>setError(err.message));}},[scanning,navigate]);const handleBack=()=>{navigate(-1);// Go back to the previous page\n};return/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',height:'auto'},children:scanning&&/*#__PURE__*/_jsx(\"div\",{style:{border:'2px solid #7F00FF',padding:'25px',borderRadius:'15px'},children:/*#__PURE__*/_jsx(\"video\",{ref:videoRef,style:{width:'400px',height:'auto',borderRadius:'10px'}})})}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center',marginTop:'10px'},children:/*#__PURE__*/_jsx(Button,{color:\"violet\",onClick:handleBack,children:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"})}),error&&/*#__PURE__*/_jsx(Message,{negative:true,children:error}),transactionDetails&&/*#__PURE__*/_jsxs(Segment,{children:[/*#__PURE__*/_jsx(Header,{as:\"h3\",children:\"Transaction Details\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"To Username:\"}),\" \",transactionDetails.toUsername]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Amount:\"}),\" \",transactionDetails.amount]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Currency:\"}),\" \",transactionDetails.currency]}),/*#__PURE__*/_jsx(Button,{color:\"violet\",onClick:()=>navigate('/confirm-transaction',{state:{transactionDetails}}),children:\"Confirm Transaction\"})]})]});};export default ScanQR;","map":{"version":3,"names":["React","useState","useRef","useEffect","Container","Message","Segment","Header","Button","jsQR","useAuth","backApi","handleLogError","useNavigate","jsx","_jsx","jsxs","_jsxs","ScanQR","getUser","navigate","error","setError","transactionDetails","setTransactionDetails","scanning","setScanning","videoRef","handleScanQR","canvas","document","createElement","context","getContext","video","current","navigator","mediaDevices","getUserMedia","facingMode","then","stream","srcObject","setAttribute","play","scan","readyState","HAVE_ENOUGH_DATA","height","videoHeight","width","videoWidth","drawImage","imageData","getImageData","code","data","transactionData","JSON","parse","getTracks","forEach","track","stop","state","e","requestAnimationFrame","catch","err","message","handleBack","children","style","display","justifyContent","alignItems","border","padding","borderRadius","ref","marginTop","color","onClick","negative","as","toUsername","amount","currency"],"sources":["/Users/timurinamkhojayev/Desktop/demo-crypto/order-ui/src/components/user/ScanQR.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { Container, Message, Segment, Header, Button } from 'semantic-ui-react';\nimport jsQR from 'jsqr';\nimport { useAuth } from '../context/AuthContext';\nimport { backApi } from '../misc/BackApi';\nimport { handleLogError } from '../misc/Helpers';\nimport { useNavigate } from 'react-router-dom';\n\nconst ScanQR = () => {\n    const { getUser } = useAuth();\n    const navigate = useNavigate();\n    const [error, setError] = useState(null);\n    const [transactionDetails, setTransactionDetails] = useState(null);\n    const [scanning, setScanning] = useState(false);\n    const videoRef = useRef(null);\n\n    const handleScanQR = () => {\n        setScanning(true);\n        setError(null);\n        setTransactionDetails(null);\n    };\n\n    useEffect(() => {\n        handleScanQR();\n    }, []);\n\n    useEffect(() => {\n        if (scanning) {\n            const canvas = document.createElement('canvas');\n            const context = canvas.getContext('2d');\n            const video = videoRef.current;\n\n            navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } }).then(stream => {\n                video.srcObject = stream;\n                video.setAttribute('playsinline', true);\n                video.play();\n\n                const scan = () => {\n                    if (video.readyState === video.HAVE_ENOUGH_DATA) {\n                        canvas.height = video.videoHeight;\n                        canvas.width = video.videoWidth;\n                        context.drawImage(video, 0, 0, canvas.width, canvas.height);\n\n                        const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n                        const code = jsQR(imageData.data, imageData.width, imageData.height);\n\n                        if (code) {\n                            try {\n                                const transactionData = JSON.parse(code.data);\n                                setTransactionDetails(transactionData);\n                                stream.getTracks().forEach(track => track.stop());\n                                setScanning(false);\n                                navigate('/confirm-transaction', { state: { transactionDetails: transactionData } });\n                            } catch (e) {\n                                setError('Failed to parse QR code data');\n                            }\n                        }\n                    }\n                    if (scanning) {\n                        requestAnimationFrame(scan);\n                    }\n                };\n                scan();\n            }).catch(err => setError(err.message));\n        }\n    }, [scanning, navigate]);\n\n    const handleBack = () => {\n        navigate(-1); // Go back to the previous page\n    };\n\n    return (\n        <Container>\n            <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: 'auto' }}>\n                {scanning && (\n                    <div style={{ border: '2px solid #7F00FF', padding: '25px', borderRadius: '15px' }}>\n                        <video ref={videoRef} style={{ width: '400px', height: 'auto', borderRadius: '10px' }} />\n                    </div>\n                )}\n            </div>\n            <div style={{ display: 'flex', justifyContent: 'center', marginTop: '10px' }}>\n                <Button color='violet' onClick={handleBack}>Отменить</Button>\n            </div>\n            {error && <Message negative>{error}</Message>}\n            {transactionDetails && (\n                <Segment>\n                    <Header as=\"h3\">Transaction Details</Header>\n                    <p><strong>To Username:</strong> {transactionDetails.toUsername}</p>\n                    <p><strong>Amount:</strong> {transactionDetails.amount}</p>\n                    <p><strong>Currency:</strong> {transactionDetails.currency}</p>\n                    <Button color='violet' onClick={() => navigate('/confirm-transaction', { state: { transactionDetails } })}>Confirm Transaction</Button>\n                </Segment>\n            )}\n        </Container>\n    );\n};\n\nexport default ScanQR;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}